#include <avr/io.h>
#include <avr/interrupt.h>

#include "led.h"
#include "buzzer.h"
#include "fnd.h"
#include "key.h"
#include "delay.h"

const unsigned char LED_Pattern[8] = {0x00,0x81,0x42,0x24,0x18,0x55,0xaa,0xff};

int main(void)
{
	unsigned char Key_Push,i;
	LED_Init();
	Buzzer_Init();
	Key_Init();
	FND_Init();
	Buzzer_On(1);
	Delay(10000);
	Buzzer_On(0);
	
	/* 외부인터럽트 초기화 */
	EICRB = (EICRB & ~0x03) | 0x02;	//Falling Edge
	EIMSK |= (1 << INT4);		

	sei();		//Enable Global Interrupt

	
	while(1)
	{

		Key_Push = Key_Input();
		if(Key_Push)
		{
			Buzzer_On(1);
		}
		else
		{
			Buzzer_On(0);
		}
		for(i=0;i<8;i++)
		{
			LED_On(LED_Pattern[i]);
			Delay(10000);
		}
	}
}

ISR(INT4_vect)
{
	static unsigned char KeyCount = 0;
	KeyCount++;
	FND_On(KeyCount % 10,0,0);
}
