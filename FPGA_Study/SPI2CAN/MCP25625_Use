<TX>
총 14BYTE 사용
1) 첫 번째 1BYTE는 TXBxCTRL레지스터(전송 조건 결정, 전송 상태)
	(TXREQ비트)

2)다음 5BYTE는 Standard or Extended 정보와 메세지 중재 정보
	(TXBxSIDH,TXBxSIDL,TXBxEID8,TXBxEID0,TXBxDLC)
	- TXBxSIDH : Standard identifier
	- TXBxSIDL : Standard identifier and Extended identifier Enable bit
	- TXBxEID8 : Extended identifier bits
	- TXBxEID0 : Extended identifier bits
	- TXBxDLC  : DATA Length

3) 마지막 8BYTE는 데이터.
	TXBxDn


- TX Interrupt 사용하지 않기 때문에 CANINTE레지스터의 TXxIE 비활성화
- 송신 중 => TXREQ=1 / 송신 가능 => TXREQ=0
- TXBxCTRL 레지스터의 TXP 비트로 우선순위 결정 TXP=11 가장 높음

메세지를 전송하려면 각 버퍼에 TXREQ비트를 설정해야한다.
1) SPI WRITE명령을 통해 레지스터에 쓰기
2) SPI TRS명령 보내기
3) 전송할 버퍼에 대해 TxnRTS핀 LOW로 설정


전송 완료되면 TXxIF=1




TXRTSCTRL 레지스터는 CAN 컨트롤러가 컨피규레이션 모드에있을 때만 수정할 수 있습니다 (2.0 "동작 모드"참조). Request-to-Send 핀으로 동작하도록 구성된 경우, 핀은 송신 버퍼 용 TXBxCTRL 레지스터의 해당 TXREQ 비트에 매핑된다. TXREQ 비트는 TxnRTS 핀의 하강 에지에 의해 래치된다.
TxnRTS 핀은 RxnBF 핀이 로우가 될 때 자동으로 메시지 전송을 시작하기 위해 RxnBF 핀에 직접 연결될 수 있도록 설계되어있다.

============================================================================================================================================================================================================
<RX>
2개의 수신 버퍼가 있다. (각 수신 버퍼에는 필터가 있다.)
세번째 수신 버퍼 역할하는 MAB가 있다.( 수신된 모든 메세지를 어셈블한다.) 
메세지는 수용필터 기준이 충족되는 경우에만 RXBx 버퍼로 전송된다.

- RXB0CTRL REG
	RXM bit : 00 Mask,Filter OFF => receives any message.
	RTR bit
	BUKT bit : 1: RX0 다 차면 RX1에 쓴다.
	FILHIT bit : 1=> Acceptance Filter1(RXF1) 0=> Acceptance Filter0(RXF0)

- RXBxSIDH REG (Standard identifier bits)	
- RXBxSIDL REG (Standard identifier bits / Extended identifier Enable / Extended identifier bits)
- RXBxEID8 REG (Extended identifier bits)
- RXBxEID0 REG (Extended identifier bits)
- RXBxDLC REG (DATA LENGTH)
	RTR bit : 
	DLC bit :
- RXBxDn REG (DATA BYTE)
- RXFxSIDH REG(Standard identifier Filter bits)
	수신된 메세지의 standard식별자 부분의 비트<10:3>에 적용될 필터 비트를 보유
- RXFxSIDL REG(Standard identifier Filter bits / Extended Filter Enable)
- RXFxEID8 REG(Extended identifier Filter bits)
이 비트는 수신 된 메시지의 확장 식별자 부분의 비트 <15 : 8>에 적용될 필터 비트를 보유합니다.
또는 RXM <1 : 0> = 00 및 EXIDE = 0에 해당하는 경우 수신 된 데이터의 Byte를 0으로 만듭니다.
- RXFxEID0 REG(Extended identifier FIlter bits)
이 비트는 수신 된 메시지의 확장 식별자 부분의 비트 <7 : 0>에 적용될 필터 비트를 보유합니다.
또는 RXM <1 : 0> = 00 및 EXIDE = 0에 해당하는 경우 수신 된 데이터의 Byte를 1으로 만듭니다.

메세지 수신하면 RXxIF = 1 새로운 메세지를 받으려면 RXxIF =0해줘야 한다.

인터럽트를 설정하면 INT핀으로 수신되었음을 확인한다.
또는 Receive Buffer Full Pin으로 구성된 경우 RXnBF=0된다

-----------------------------------------------------------------------------------------------
<우선순위>
우선 순위가 더 높은 버퍼 인 RXB0에는 하나의 마스크와 두 개의 메시지 허용 필터가 연결되어 있습니다. 수신 된 메시지는 먼저 마스크에 적용되고 RXB0에 대한 필터가 먼저 적용됩니다.RXB1은 우선 순위가 낮은 버퍼로 하나의 마스크와 4 개의 수용 필터가 연결되어 있습니다.메시지가 수신되면 RXBxCTRL <3 : 0> 비트는 수신을 활성화 한 수용 필터 번호와 수신 된 메시지가 원격 전송 요청인지 여부를 나타냅니다.
--------------------------------------------------------------------------------------
<RXM>
RXBxCTRL 레지스터의 RXM <1 : 0> 비트는 특수 수신 모드를 설정합니다. 정상적으로, 이들 비트들은 '00'으로 클리어되어 적절한 수용 필터들에 의해 결정되는 모든 유효한 메시지들의 수신을 가능하게한다. 이 경우 표준 또는 확장 메시지를 수신할지 여부는 RFXxSIDL 레지스터의 EXIDE 비트에 의해 결정됩니다.

RXMx 비트가 '11'로 설정된 경우 버퍼는 수락 필터의 값과 관계없이 모든 메시지를 수신합니다. 또한 메시지 끝에 EOF (End of Frame) 전에 오류가있는 경우 오류 프레임 전에 MAB에 어셈블 된 메시지 부분이 버퍼로로드됩니다. 이 모드는 CAN 시스템 디버깅에 약간의 가치가 있으며 실제 시스템 환경에서는 사용되지 않습니다.
------------------------------------------------------------------------------------------
<RXBxBF>
다양한 조건에서 MCU에 인터럽트 신호를 제공하는 INT 핀 외에도 RXB0 또는 RXB1에 유효한 메시지가 각각로드되었음을 나타 내기 위해 수신 버퍼 풀 핀 (Rx0BF 및 Rx1BF)을 사용할 수 있습니다. 핀은 세 가지 다른 구성을 가지고 있습니다 (표 3-1 참조).

MAB에서 수신 된 메시지는 초기에 RXB0의 마스크 및 필터에 적용됩니다. 또한 필터 일치가 하나만 발생합니다 (예 : 메시지가 RXF0 및 RXF2와 일치하는 경우 RXF0에 대한 일치가 발생하고 메시지가 RXB0으로 이동 됨)

1) Disable
RxnBF 핀은 BFPCTRL 레지스터의 BxBFE 비트를 클리어함으로써 하이 임피던스 상태로 디스 에이블 될 수있다.

2) Buffer Full INT
RxnBF 핀은 버퍼 풀 인터럽트 핀 또는 표준 디지털 출력으로 작동하도록 구성 할 수 있습니다.
이 핀의 구성 및 상태는 BFPCTRL 레지스터 (레지스터 4-11)를 통해 사용할 수 있습니다. 인터럽트 모드 (BFPCTRL 레지스터의 BxBFE 및 BxBFM 비트 설정)로 작동하도록 설정되면이 핀은 액티브 로우이며 각 수신 버퍼에 대한 CANINTF 레지스터의 RXxIF 비트에 매핑됩니다. 이 비트가 수신 버퍼 중 하나에 대해 하이가되면 (유효한 메시지가 버퍼에로드되었음을 나타냄) 해당 RxnBF 핀이 로우가된다. MCx에 의해 RXxIF 비트가 클리어되면, 다음 메시지가 수신 버퍼에로드 될 때까지 해당 인터럽트 핀이 로직 하이 상태가됩니다.

3) 디지털출력
디지털 출력으로 사용될 때, BFPCTRL 레지스터의 BxBFM 비트는 클리어되어야하고 BxBFE 비트는 연관된 버퍼에 대해 설정되어야합니다. 이 모드에서 핀의 상태는 동일한 레지스터의 BxBFS 비트에 의해 제어됩니다. BxBFS 비트에 '1'을 쓰면 관련 버퍼 풀 핀에서 하이 레벨이 구동되고 '0'이면 핀이 로우로 구동된다. 이 모드에서 핀을 사용할 때 핀의 상태는 SPI BIT MODIFY 명령을 사용하여 버퍼 풀 핀 중 하나에서 글리치가 발생하는 것을 방지해야한다.

------------------------------------------------------------------------------------------------
<Mask and Filter>
메시지 수용 필터와 마스크는 메시지 어셈블리 버퍼의 메시지를 수신 버퍼 중 하나에로드해야하는지 결정하는 데 사용됩니다 (그림 3-9 참조).
유효한 메시지가 MAB로 수신되면 메시지의 식별자 필드가 필터 값과 비교됩니다. 일치하는 것이 있으면 해당 메시지가 해당 수신 버퍼에로드됩니다.

<Data Filtering>
표준 데이터 프레임(11비트 식별자)을 수신할 때 MCP25625는 데이터 필드의 첫 16비트(데이터 바이트 0 및 1)에 일반적으로 확장 식별자와 연관된 16비트 마스크 및 필터를 자동으로 적용한다. 그림 3-8은 마스크와 필터가 확장 및 표준 데이터 프레임에 어떻게 적용되는지 보여준다.
데이터 바이트 필터링은 첫 번째 데이터 바이트 (예 : DeviceNetTM)에서 필터링하는 상위 계층 프로토콜 (HLP)을 구현할 때 MCU의로드를 줄입니다.

<Filter Matching>
필터 마스크 (레지스터 4-22에서 4-25 참조)는 식별자에서 어떤 비트가 필터로 검사되는지를 결정하는 데 사용됩니다.
ID의 각 비트를 마스크 및 필터와 비교하여 메시지를 수신 버퍼에로드해야하는지 여부를 결정하는 진실성 테이블이 표 3-2에 나와 있습니다.
마스크는 기본적으로 수락 필터를 적용 할 비트를 결정합니다. 마스크 비트가 0으로 설정되면 필터 비트에 관계없이 해당 비트가 자동으로 수락됩니다.


<FilHIT>
수신 된 메시지의 필터 일치는 연관된 RXBxCTRL 레지스터의 FILHIT <2 : 0> 비트에 의해 결정될 수 있습니다. RXB0CTRL 레지스터의 FILHIT0 비트는 버퍼 0과 연관되고 RXB1CTRL 레지스터의 FILHIT <2 : 0> 비트는 버퍼 1과 연관됩니다.

수신 버퍼 1 (RXB1)에 대한 3 개의 FILHITx 비트는 다음과 같이 코딩됩니다.

'000'과 '001'은 RXB0CTRL의 BUKT 비트가 설정된 경우에만 발생하여 RXB0 메시지가 RXB1로 롤오버될 수 있다.

RXB0CTRL에는 BUKT 비트(BUKT1)와 FILHIT <0> 비트 사본이 2개 포함되어 있다.

BUKT 비트의 코딩은 이 세 비트를 RXB1CTRL 레지스터의 FILHITx 비트와 유사하게 사용하고, RXB0 또는 RXB1로 롤오버한 후 필터의 적중률(RXF0 및 RXF1)을 구별할 수 있게 한다.

BUKT 비트가 클리어 인 경우, 6 개의 필터에 대응하는 6 개의 코드가있다. BUKT 비트가 설정되면 6 개의 필터에 해당하는 6 개의 코드와 RXB1로 롤오버하는 RXF0 및 RXF1 필터에 해당하는 2 개의 추가 코드가 있습니다.

둘 이상의 수락 필터가 일치하면 FILHITx 비트는 일치하는 가장 낮은 번호의 필터의 이진 값을 인코딩합니다. 예를 들어 필터 RXF2와 RXF4가 일치하면 FILHITx에 RXF2 값이로드됩니다. 이것은 우선 순위가 더 낮은 번호가 매겨진 필터로 수용 필터의 우선 순위를 결정합니다. 메시지는 필터 번호의 오름차순으로 필터와 비교됩니다. 또한 메시지가 하나의 버퍼에만 수신되도록합니다. 이는 RXB0이 RXB1보다 우선 순위가 높음을 의미합니다.










메시지가 수락되면 MAB의 전체 내용이 수신 버퍼로 이동합니다. 즉, 식별자 유형 (표준 또는 확장)과 수신 된 데이터 바이트 수에 관계없이 전체 수신 버퍼가 MAB 내용으로 덮어 쓰여집니다.





청취 전용 모드는 무음 모드로,이 모드 (오류 플래그 또는 확인 신호 포함) 중에는 메시지가 전송되지 않습니다.
청취 전용 모드에서는 RXBxCTRL 레지스터의 필터 및 마스크 또는 RXM <1 : 0> 비트와 관계없이 유효 및 무효 메시지가 수신됩니다. 오류 카운터는이 상태에서 재설정 및 비활성화됩니다. 청취 전용 모드는 CANCTRL 레지스터에 REQOPx 비트를 설정하여 활성화됩니다.










RXB0CTRL 레지스터에서 RXM0,1비트
Extended ID Filter register, RXFxEID8, RXFxEID0 레지스터들은 Standard ID가 있는 메세지의 데이터의 처음 2바이트에 적용된다.

수신버퍼 RXB0 RXB1은 MAB를 통해 메세지를 수신할 수 있다.
메세지가 수신되면 MAB의 전체 내용이 수신버퍼로 이동한다.
즉, Extended유형이든 Standard유형과 수신된 데이터 바이트 수에 관계없이 전체 수신 버퍼가 MAB내용으로 덮어 씌어진다.
따라서 버퍼에 있는 모든 레지스터의 내용은 메세지를 수신할 떄 수정된 것으로 가정해야한다.

메세지가 수신버퍼 중 하나로 이동하면 CANINTF레지스터의 RXxIF=1된다.
새 메세지를 버퍼에 수신하려면 RXxIF=0으로 해야한다.

CANINTE레지스터의 RXxIE=1되면 INT핀에 인터럽트가 생성되었다는 것이다. 즉 메세지가 수신되었다.
또한 Receive Buffer Full핀으로 구성된 경우 관련 RxnBF핀이 LOW로 구동된다.

RXB0 또는 RXB1에 메세지가 수신되었음을 나타내기 위한 Receive Buffer Full Pin이 있다.(Rx0BF, Rx1BF)
Receive Buffer Full Pin은 세가지 구성이 있다.
1)Disabled
2)Buffer Full Interrupt
3)Digital Output

RxnBF 핀은 버퍼 풀 인터럽트 핀 또는 표준 디지털 출력으로 작동하도록 구성 할 수 있습니다. (BFPCTRL)
인터럽트 모드 (BFPCTRL 레지스터의 BxBFE 및 BxBFM 비트 설정)로 작동하도록 설정되면이 핀은 액티브 로우이며 각 수신 버퍼에 대한 CANINTF 레지스터의 RXxIF 비트에 매핑됩니다.

이 비트가 수신 버퍼 중 하나에 대해 하이가되면 (유효한 메시지가 버퍼에로드되었음을 나타냄) 해당 RxnBF 핀이 로우가된다.
MCx에 의해 RXxIF 비트가 클리어되면, 다음 메시지가 수신 버퍼에로드 될 때까지 해당 인터럽트 핀이 로직 하이 상태가됩니다.


필터기준!!!!!!
<필터,마스크>
메시지 수용 필터와 마스크는 메시지 어셈블리 버퍼의 메시지를 수신 버퍼 중 하나에로드해야하는지 결정하는 데 사용됩니다 (그림 3-9 참조).

유효한 메시지가 MAB로 수신되면 메시지의 식별자 필드가 필터 값과 비교됩니다. 일치하는 것이 있으면 해당 메시지가 해당 수신 버퍼에로드됩니다.
